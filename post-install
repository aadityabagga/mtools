# post installation tasks

post_install () {
	# Copying gparted.desktop
	install -Dm 755 /usr/share/applications/gparted.desktop "$WORKDIR/$PROFILE/$ARCH/live-image/home/manjaro/Desktop/gparted.desktop" || exit 1
	sed 's|/usr/bin/gparted_polkit %f|gksudo gparted|g' -i "$WORKDIR/$PROFILE/$ARCH/live-image/home/manjaro/Desktop/gparted.desktop" || exit 1
	echo "GParted.desktop copied to livecd image."

	# Copying cli-installer.desktop and beginner's guide
	cp -p "${TOOLSDIR}/files/installer-launcher-cli.desktop" "$WORKDIR/$PROFILE/$ARCH/live-image/home/manjaro/Desktop/"
	cp -p "${TOOLSDIR}/files/calamares.desktop" "$WORKDIR/$PROFILE/$ARCH/live-image/home/manjaro/Desktop/"
	cp -p "${TOOLSDIR}/files/Beginner_User_Guide.pdf" "$WORKDIR/$PROFILE/$ARCH/live-image/home/manjaro/Desktop/"
	echo "cli-installer.desktop and Beginner_User_Guide.desktop copied to livecd."

	# Disabling automatic swap partition mounting in livecd
	#sed 's|swapon ${swapdev}|#swapon ${swapdev}|' -i "$WORKDIR/$PROFILE/$ARCH/live-image/opt/livecd/util-livecd.sh" || exit 1
	sed 's|swapon ${swapdev}|echo swap ${swapdev}|' -i "$WORKDIR/$PROFILE/$ARCH/live-image/usr/lib/manjaro-tools/util-live.sh" || exit 1
	echo "Automatic swap partition commented out."

	# Copying modified setup
	cp "${TOOLSDIR}/files/cli-installer" "$WORKDIR/$PROFILE/$ARCH/live-image/usr/bin/cli-installer" || exit 1
	cp "${TOOLSDIR}/files/util-inst.sh"  "$WORKDIR/$PROFILE/$ARCH/live-image/usr/lib/manjaro-tools/util-inst.sh" || exit 1
	echo "Copied modified setup."

	# Changing log location in setup
	#sed 's|LOG="/dev/tty8"|LOG="/var/log/setup.log"|' -i "$WORKDIR/$PROFILE/$ARCH/live-image/opt/livecd/setup-0.9" || exit 1
	#echo "Log location in setup changed."

	# Revert Packages file
	sed '/## ucode for new cpus/ a\
intel-ucode' -i "${PROFILEDIR}/shared/Packages-Root" || exit 1
	echo "shared/Packages-Root reverted."

	# Reverting pacman.conf
	rm "${PROFILEDIR}/${COMMUNITY_PROFILE}/pacman-default.conf" "${PROFILEDIR}/${COMMUNITY_PROFILE}/pacman-multilib.conf" || exit 1
	echo "pacman.conf removed."
}
